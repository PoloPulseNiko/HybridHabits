<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog - The Hybrid Habits</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header></header>

    <main>
        <section id="blog" class="hero">
            <h2>Hybrid Habits Blog</h2>
            <p class="tagline">Thoughts, insights, and stories</p>
            
            <div class="blog-posts">
                <p class="post-excerpt">Loading posts...</p>
            </div>
        </section>
    </main>

    <footer></footer>
    <script src="load-components.js"></script>
    <script src="music-manager.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const postsContainer = document.querySelector('.blog-posts');
            if (!postsContainer) {
                return;
            }

            const renderError = message => {
                postsContainer.innerHTML = `<p class="post-excerpt">${message}</p>`;
            };

            fetch('blogentries/entries.json')
                .then(response => response.json())
                .then(data => {
                    const posts = (data && Array.isArray(data.posts)) ? [...data.posts] : [];

                    posts.sort((a, b) => {
                        const aDateTime = `${a.sortDate || ''}T${a.sortTime || '00:00'}`;
                        const bDateTime = `${b.sortDate || ''}T${b.sortTime || '00:00'}`;
                        return bDateTime.localeCompare(aDateTime);
                    });

                    postsContainer.innerHTML = '';

                    if (!posts.length) {
                        renderError('No posts yet.');
                        return;
                    }

                    posts.forEach(post => {
                        const article = document.createElement('article');
                        article.className = 'blog-post';

                        const title = document.createElement('h3');
                        title.className = 'post-title';
                        title.textContent = post.title || 'Untitled';

                        const date = document.createElement('p');
                        date.className = 'post-date';
                        const dateText = post.displayDate || post.sortDate || '';
                        const timeText = post.displayTime ? ` at ${post.displayTime}` : '';
                        date.textContent = dateText + timeText;

                        const excerpt = document.createElement('p');
                        excerpt.className = 'post-excerpt';
                        excerpt.textContent = post.excerpt || '';

                        const link = document.createElement('a');
                        link.className = 'read-more';
                        link.href = `blog-entry.html?slug=${encodeURIComponent(post.slug || '')}`;
                        link.textContent = 'Read more â†’';

                        article.append(title, date, excerpt, link);
                        postsContainer.appendChild(article);
                    });
                })
                .catch(() => {
                    renderError('Could not load posts right now.');
                });
        });
    </script>
</body>
</html>